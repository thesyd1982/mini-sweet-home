#!/bin/bash

# ===============================
# ğŸ§ª TEST INSTALLATION V4
# ===============================

echo "ğŸ§ª Tests de validation des dotfiles V4..."

tests_passed=0
tests_total=0

# Test 1: Configuration shell
((tests_total++))
if [[ -f "$HOME/.zshrc" ]]; then
    echo "  âœ… Configuration shell trouvÃ©e"
    ((tests_passed++))
else
    echo "  âŒ Configuration shell manquante"
fi

# Test 2: Chargement ZSH
((tests_total++))
if zsh -c "source ~/.zshrc && echo 'test'" >/dev/null 2>&1; then
    echo "  âœ… Configuration ZSH se charge correctement"
    ((tests_passed++))
else
    echo "  âŒ Erreur de chargement ZSH"
fi

# Test 3: Fonctions disponibles
((tests_total++))
if zsh -c "source ~/.zshrc && type jp" >/dev/null 2>&1; then
    echo "  âœ… Fonctions personnalisÃ©es chargÃ©es"
    ((tests_passed++))
else
    echo "  âŒ Fonctions personnalisÃ©es manquantes"
fi

# Test 4: Outils essentiels
((tests_total++))
essential_tools=("git" "zsh" "tmux" "nvim")
tools_found=0

for tool in "${essential_tools[@]}"; do
    if command -v "$tool" >/dev/null 2>&1; then
        ((tools_found++))
    fi
done

if [[ $tools_found -eq ${#essential_tools[@]} ]]; then
    echo "  âœ… Tous les outils essentiels sont installÃ©s"
    ((tests_passed++))
else
    echo "  âŒ Outils manquants: $((${#essential_tools[@]} - tools_found))"
fi

# Test 5: Liens symboliques
((tests_total++))
symlinks=(".zshrc" ".tmux.conf" ".gitconfig")
links_found=0

for link in "${symlinks[@]}"; do
    if [[ -L "$HOME/$link" ]]; then
        ((links_found++))
    fi
done

if [[ $links_found -eq ${#symlinks[@]} ]]; then
    echo "  âœ… Tous les liens symboliques sont crÃ©Ã©s"
    ((tests_passed++))
else
    echo "  âŒ Liens symboliques manquants: $((${#symlinks[@]} - links_found))"
fi

echo
echo "ğŸ“Š RÃ©sultats: $tests_passed/$tests_total tests passÃ©s"

if [[ $tests_passed -eq $tests_total ]]; then
    echo "ğŸ‰ Installation validÃ©e avec succÃ¨s!"
    exit 0
else
    echo "âš ï¸ Installation partielle - quelques Ã©lÃ©ments manquent"
    exit 1
fi
